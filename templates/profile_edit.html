<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="edit_title">文档编辑 - GlobalAsianElite</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-purple: #5e3a6e;
            --secondary-purple: #8e44ad;
        }
        body {
            background-color: #f9f9f9;
            color: #333;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar {
            background-color: var(--primary-purple);
            min-height: 60px;
        }
        .navbar-brand, .nav-link {
            color: white !important;
        }
        .section-header {
            color: var(--primary-purple);
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        .sub-header {
            color: var(--primary-purple);
            font-size: 1.2rem;
            margin-top: 20px;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .form-label {
            color: #666;
            font-weight: 500;
        }
        .btn-purple {
            background-color: var(--primary-purple);
            color: white;
            border: none;
            padding: 8px 30px;
        }
        .btn-purple:hover {
            background-color: #4a2e56;
            color: white;
        }
        .main-content {
            background: white;
            padding: 30px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-top: 20px;
            margin-bottom: 50px;
        }
        .radio-group label {
            margin-right: 20px;
            font-weight: normal;
            cursor: pointer;
        }
        .radio-group input[type="radio"] {
            margin-right: 5px;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg">
    <div class="container">
        <a class="navbar-brand" href="/dashboard">GlobalAsianElite</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/profile/photos" data-i18n="nav_photos">照片</a></li>
                <li class="nav-item"><a class="nav-link" href="/verification" data-i18n="nav_verification">个人文档</a></li>
                <li class="nav-item"><a class="nav-link" href="/dashboard" data-i18n="nav_match">佳缘条件</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <div class="main-content">
        <h2 class="section-header" data-i18n="edit_title">文档编辑</h2>
        <p class="text-muted small" data-i18n="edit_desc">回答这些问题不但可以让会员在搜索结果中找到您的文档，也可以让我们为您找到更适合您的对象。</p>

        <form action="/profile/update" method="post">
            
            <h4 class="sub-header" id="basic" data-i18n="section_basic">基本资料</h4>
            
            <div class="mb-3">
                <label class="form-label" data-i18n="label_name">名字:</label>
                <input type="text" class="form-control w-50" name="name" value="{{ user.name or '' }}" placeholder="例如: 周琳">
            </div>

            <div class="mb-3">
                <label class="form-label" data-i18n="label_iam">我是:</label>
                <div class="d-flex align-items-center">
                    <input type="text" class="form-control w-25 me-2" value="{{ '女性' if user.gender == 'female' else '男性' }}" disabled>
                    <button type="button" class="btn btn-light btn-sm border" data-i18n="btn_change">更改</button>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label" data-i18n="label_dob">出生日期:</label>
                <div class="d-flex align-items-center gap-2 w-50">
                    <select class="form-select" name="dob_month">
                        <option value="" data-i18n="month_unit">月</option>
                        {% for i in range(1, 13) %}
                        <option value="{{ i }}">{{ i }} <span data-i18n="month_unit">月</span></option>
                        {% endfor %}
                    </select>
                    <select class="form-select" name="dob_day">
                        <option value="" data-i18n="day_unit">日</option>
                        {% for i in range(1, 32) %}
                        <option value="{{ i }}">{{ i }} <span data-i18n="day_unit">日</span></option>
                        {% endfor %}
                    </select>
                    <select class="form-select" name="dob_year">
                        <option value="" data-i18n="year_unit">年</option>
                        {% for i in range(1960, 2006) %}
                        <option value="{{ i }}">{{ i }}</option>
                        {% endfor %}
                    </select>
                    <button type="button" class="btn btn-light btn-sm border text-nowrap" data-i18n="btn_change">更改</button>
                </div>
                <small class="text-muted">* 为保护您的隐私，我们仅保存您的出生年月</small>
            </div>

            <div class="row mb-4">
                <div class="col-md-4">
                    <label class="form-label" data-i18n="label_country">国家:</label>
                    <select class="form-select" id="country-select" name="country"></select>
                </div>
                <div class="col-md-4">
                    <label class="form-label" data-i18n="label_state">省/州:</label>
                    <select class="form-select" id="state-select" name="state"></select>
                </div>
                <div class="col-md-4">
                    <label class="form-label" data-i18n="label_city">城市:</label>
                    <select class="form-select" id="city-select" name="city"></select>
                </div>
                <input type="hidden" id="init-country" value="{{ user.country or '' }}">
                <input type="hidden" id="init-state" value="{{ user.state or '' }}">
                <input type="hidden" id="init-city" value="{{ user.city or '' }}">
            </div>

        <h4 class="sub-header" id="appearance" data-i18n="section_appearance">外表</h4>

            <div class="mb-3">
                <label class="form-label d-block" data-i18n="label_hair">发色:</label>
                <div class="radio-group">
                    <label><input type="radio" name="hair_color" value="黑色" {% if user.hair_color == '黑色' %}checked{% endif %}> <span data-i18n="hair_black">黑色</span></label>
                    <label><input type="radio" name="hair_color" value="金发" {% if user.hair_color == '金发' %}checked{% endif %}> <span data-i18n="hair_blonde">金发</span></label>
                    <label><input type="radio" name="hair_color" value="棕色" {% if user.hair_color == '棕色' %}checked{% endif %}> <span data-i18n="hair_brown">棕色</span></label>
                    <label><input type="radio" name="hair_color" value="白色/灰色" {% if user.hair_color == '白色/灰色' %}checked{% endif %}> <span data-i18n="hair_white_gray">白色/灰色</span></label>
                    <label><input type="radio" name="hair_color" value="红色" {% if user.hair_color == '红色' %}checked{% endif %}> <span data-i18n="hair_red">红色</span></label>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label d-block" data-i18n="label_eye">眼睛颜色:</label>
                <div class="radio-group">
                    <label><input type="radio" name="eye_color" value="黑色" {% if user.eye_color == '黑色' %}checked{% endif %}> <span data-i18n="eye_black">黑色</span></label>
                    <label><input type="radio" name="eye_color" value="蓝色" {% if user.eye_color == '蓝色' %}checked{% endif %}> <span data-i18n="eye_blue">蓝色</span></label>
                    <label><input type="radio" name="eye_color" value="棕色" {% if user.eye_color == '棕色' %}checked{% endif %}> <span data-i18n="eye_brown">棕色</span></label>
                    <label><input type="radio" name="eye_color" value="绿色" {% if user.eye_color == '绿色' %}checked{% endif %}> <span data-i18n="eye_green">绿色</span></label>
                    <label><input type="radio" name="eye_color" value="灰色" {% if user.eye_color == '灰色' %}checked{% endif %}> <span data-i18n="eye_gray">灰色</span></label>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label" data-i18n="label_height">身高:</label>
                <select class="form-select w-25" name="height">
                    <option value="">请选择...</option>
                    {% for i in range(140, 200) %}
                    <option value="{{ i }}cm" {% if user.height == (i|string + 'cm') %}selected{% endif %}>{{ i }} cm</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label" data-i18n="label_weight">体重:</label>
                <select class="form-select w-25" name="weight">
                    <option value="">请选择...</option>
                    {% for i in range(40, 100) %}
                    <option value="{{ i }}kg" {% if user.weight == (i|string + 'kg') %}selected{% endif %}>{{ i }} kg</option>
                    {% endfor %}
                </select>
        </div>

        <h4 class="sub-header" id="match" data-i18n="section_match">佳缘条件</h4>
        <div class="row mb-3">
            <div class="col-md-4">
                <label class="form-label" data-i18n="label_match_gender">期望对象性别:</label>
                <select class="form-select" name="match_gender">
                    <option value="" data-i18n="gender_any">不限</option>
                    <option value="male" {% if user.match_gender=='male' %}selected{% endif %} data-i18n="gender_male">男</option>
                    <option value="female" {% if user.match_gender=='female' %}selected{% endif %} data-i18n="gender_female">女</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label" data-i18n="label_match_age_min">期望年龄最小:</label>
                <select class="form-select" name="match_age_min">
                    <option value="" data-i18n="gender_any">不限</option>
                    {% for i in range(30, 81) %}
                    <option value="{{ i }}" {% if user.match_age_min == i %}selected{% endif %}>{{ i }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label" data-i18n="label_match_age_max">期望年龄最大:</label>
                <select class="form-select" name="match_age_max">
                    <option value="" data-i18n="gender_any">不限</option>
                    {% for i in range(35, 100) %}
                    <option value="{{ i }}" {% if user.match_age_max == i %}selected{% endif %}>{{ i }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-purple" data-i18n="btn_save">保存并继续</button>
        </div>

        </form>
    </div>
</div>

<script src="/static/js/translations.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        applyLanguage();
        initLocation();
    });

const countries = [
    "United States","Canada","Mexico","Brazil","Argentina","Chile","Colombia","Peru","Venezuela","Uruguay","Paraguay","Bolivia",
    "United Kingdom","Ireland","France","Germany","Italy","Spain","Portugal","Netherlands","Belgium","Luxembourg","Switzerland","Austria",
    "Sweden","Norway","Denmark","Finland","Iceland","Poland","Czech Republic","Slovakia","Hungary","Romania","Bulgaria","Greece","Turkey",
    "Russia","Ukraine","Belarus","Lithuania","Latvia","Estonia","Serbia","Croatia","Slovenia","Bosnia and Herzegovina","North Macedonia","Albania",
    "China","Hong Kong","Macau","Taiwan","Japan","South Korea","Mongolia","Singapore","Malaysia","Thailand","Vietnam","Indonesia","Philippines",
    "Cambodia","Laos","Myanmar","Brunei","India","Bangladesh","Pakistan","Sri Lanka","Nepal","Bhutan","Maldives",
    "Australia","New Zealand",
    "United Arab Emirates","Saudi Arabia","Qatar","Kuwait","Bahrain","Oman","Israel","Jordan","Lebanon","Iran","Iraq","Egypt","Morocco","Tunisia","Algeria",
    "South Africa","Kenya","Nigeria","Ghana","Ethiopia","Tanzania","Uganda","Rwanda","Senegal","Ivory Coast"
];

const regions = {
  "United States": {
    "California": ["Los Angeles","San Francisco","San Diego","San Jose"],
    "New York": ["New York City","Buffalo","Rochester"],
    "Texas": ["Houston","Dallas","Austin"],
    "Florida": ["Miami","Orlando","Tampa"],
    "Illinois": ["Chicago","Aurora","Naperville"]
  },
  "Canada": {
    "Ontario": ["Toronto","Ottawa","Mississauga"],
    "British Columbia": ["Vancouver","Victoria","Surrey"],
    "Quebec": ["Montreal","Quebec City"],
  },
  "Australia": {
    "New South Wales": ["Sydney","Newcastle"],
    "Victoria": ["Melbourne","Geelong"],
    "Queensland": ["Brisbane","Gold Coast"]
  },
  "United Kingdom": {
    "England": ["London","Manchester","Birmingham"],
    "Scotland": ["Edinburgh","Glasgow"],
    "Wales": ["Cardiff","Swansea"]
  },
  "China": {
    "北京市": ["北京市"],
    "上海市": ["上海市"],
    "广东省": ["广州市","深圳市","佛山市"],
    "浙江省": ["杭州市","宁波市"],
    "江苏省": ["南京市","苏州市"]
  },
  "Japan": {
    "Tokyo": ["Tokyo"],
    "Osaka": ["Osaka"],
    "Kanagawa": ["Yokohama"]
  },
  "Philippines": {
    "Metro Manila": ["Taguig","Manila","Quezon City"],
    "Cebu": ["Cebu City"],
    "Davao": ["Davao City"]
  }
};

function fillSelect(select, items, current) {
  select.innerHTML = '';
  const placeholder = document.createElement('option');
  placeholder.value = '';
  placeholder.textContent = '请选择...';
  // Use translations if available, otherwise 'Please select...'
  // But fillSelect is called dynamically. 
  // We can just rely on English as default or simple check.
  // Actually, let's use a translation key if we can access translations object.
  if (typeof translations !== 'undefined') {
     const lang = localStorage.getItem('lang') || 'zh';
     const t = translations[lang] || translations['en'];
     // We need a key for "Please select..."
     // Let's assume we might add one or just use hardcoded 'Please select...'
     // For now, I'll stick to 'Please select...' as default or check if we can add a key.
     // I'll leave it as is for now, maybe just "..."
     placeholder.textContent = '...'; 
  }
  
  select.appendChild(placeholder);
  (items || []).forEach(v => {
    const opt = document.createElement('option');
    opt.value = v;
    opt.textContent = v;
    if (current && current === v) opt.selected = true;
    select.appendChild(opt);
  });
  const other = document.createElement('option');
  other.value = '其他';
  
  // Use translation for 'Other'
  let otherText = 'Other';
  if (typeof translations !== 'undefined') {
      const lang = localStorage.getItem('lang') || 'zh';
      const t = translations[lang] || translations['en'];
      if (t && t.option_other) otherText = t.option_other;
  }
  other.textContent = otherText;
  
  select.appendChild(other);
}

function initLocation() {
  const countrySel = document.getElementById('country-select');
  const stateSel = document.getElementById('state-select');
  const citySel = document.getElementById('city-select');
  const currentCountry = document.getElementById('init-country').value;
  const currentState = document.getElementById('init-state').value;
  const currentCity = document.getElementById('init-city').value;

  // 国家
  const sorted = [...countries].sort();
  countrySel.innerHTML = '';
  // Add placeholder for country too
  const ph = document.createElement('option');
  ph.value = '';
  ph.textContent = '...';
  countrySel.appendChild(ph);

  sorted.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c;
    opt.textContent = c;
    if (currentCountry && currentCountry === c) opt.selected = true;
    countrySel.appendChild(opt);
  });

  function updateStates() {
    const c = countrySel.value;
    const states = regions[c] ? Object.keys(regions[c]) : [];
    fillSelect(stateSel, states, currentState);
    updateCities();
  }

  function updateCities() {
    const c = countrySel.value;
    const s = stateSel.value;
    const cities = regions[c] && regions[c][s] ? regions[c][s] : [];
    fillSelect(citySel, cities, currentCity);
  }

  countrySel.addEventListener('change', () => { updateStates(); });
  stateSel.addEventListener('change', () => { updateCities(); });

  // 初始填充
  updateStates();
}
</script>
</body>
</html>
